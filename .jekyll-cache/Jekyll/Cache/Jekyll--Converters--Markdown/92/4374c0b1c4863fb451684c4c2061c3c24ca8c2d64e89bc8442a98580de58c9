I",9<p>This post is an exercise for implementing R data structures. Specifically, the post is inspired by a guided project in <a href="https://www.dataquest.io/"><strong>Dataquest.io</strong></a>, an online platform for learning Data Science.</p>

<p>Suppose we have a number of Covid-19 cases in <a href="https://maranathaedu-my.sharepoint.com/:x:/g/personal/hendra_bunyamin_it_maranatha_edu/EeMT5JQvhpJNuCz0jCDFSpoBkMIIYZEySwcKrmLaro4g2w?e=B6lXjE"><strong>a file</strong></a>.   <br />
Letâ€™s read the dataset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span><span class="w">
</span><span class="n">dataset_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="s2">"/home"</span><span class="p">,</span><span class="s2">"hbunyamin"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Datasets"</span><span class="p">,</span><span class="s2">"Dataquest.io"</span><span class="p">)</span><span class="w">
</span><span class="n">covid_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span><span class="w"> </span><span class="s2">"covid19.csv"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<p><strong>Out</strong>:
<a href="/assets/images/01.png"><img src="/assets/images/01.png" alt="img1" class="img-responsive" /></a></p>

<p>We provide a <a href="https://github.com/dataquestio/solutions/blob/master/Mission505Solutions.Rmd">detailed description</a> from each column below:</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">Date</code>: Date</li>
  <li><code class="language-plaintext highlighter-rouge">Continent_Name</code>: Continent names</li>
  <li><code class="language-plaintext highlighter-rouge">Two_Letter_Country_Code</code>: Country codes</li>
  <li><code class="language-plaintext highlighter-rouge">Country_Region</code>: Country names</li>
  <li><code class="language-plaintext highlighter-rouge">Province_State</code>: States/province names; value is <code class="language-plaintext highlighter-rouge">All States</code> when state/provincial level data is not available</li>
  <li><code class="language-plaintext highlighter-rouge">positive</code>: Cumulative number of positive cases reported.</li>
  <li><code class="language-plaintext highlighter-rouge">active</code>: Number of actively cases on that <strong>day</strong>.</li>
  <li><code class="language-plaintext highlighter-rouge">hospitalized</code>: Cumulative number of hospitalized cases reported.</li>
  <li><code class="language-plaintext highlighter-rouge">hospitalizedCurr</code>: Number of actively hospitalized cases on that <strong>day</strong>.</li>
  <li><code class="language-plaintext highlighter-rouge">recovered</code>: Cumulative number of recovered cases reported.</li>
  <li><code class="language-plaintext highlighter-rouge">death</code>: Cumulative number of deaths reported.</li>
  <li><code class="language-plaintext highlighter-rouge">total_tested</code>: Cumulative number of tests conducted.</li>
  <li><code class="language-plaintext highlighter-rouge">daily_tested</code>: Number of tests conducted on the <strong>day</strong>; if daily data is unavailable, daily tested is averaged across number of days in between.</li>
  <li><code class="language-plaintext highlighter-rouge">daily_positive</code>: Number of positive cases reported on the <strong>day</strong>; if daily data is unavailable, daily positive is averaged across number of days in.</li>
</ol>

<p>We show some rows with only 5 columns from the dataset.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">covid_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p><strong>Out</strong>:
<a href="/assets/images/02.png"><img src="/assets/images/02.png" alt="img1" class="img-responsive" /></a></p>

<p><a href="/assets/images/Covid19-Top10-Rank-global-1June-ENG-Blue.png"><img src="/assets/images/Covid19-Top10-Rank-global-1June-ENG-Blue.png" alt="img1" class="img-responsive" /></a><em><center>$\pmb{\text{Figure } 1}$: An illustration of a summary which we would like to produce from our dataset. Image taken from <a href="https://www.thaipbsworld.com/10-countries-with-highest-number-of-covid-19-infections-as-of-june-1-2020/">Thai PBS World</a>, some rights reserved.</center></em></p>

<p>Provided this dataset, we would like to summarize the dataset into a country ranking such as $\pmb{\text{Figure }1}$. Specifically, we post two questions (<strong>Q1</strong> and <strong>Q2</strong>) as:</p>

<blockquote>
  <p><strong>Q1</strong>: <em>Which countries have had the highest number of deaths due to COVID-19?</em></p>
</blockquote>

<p>and</p>

<blockquote>
  <p><strong>Q2</strong>: <em>Which countries have had the highest number of positive cases against the number of tests?</em></p>
</blockquote>

<p>We are interested in <code class="language-plaintext highlighter-rouge">"All States"</code> values from the <code class="language-plaintext highlighter-rouge">Province_State</code> column to count all COVID-19 cases from a country; therefore, we filter only the <code class="language-plaintext highlighter-rouge">"All States"</code> values from the <code class="language-plaintext highlighter-rouge">Province_State</code> column. Moreover, we remove <code class="language-plaintext highlighter-rouge">Province_State</code> because the column does not provide any more information.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">covid_df_all_states</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">covid_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">Province_State</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All States"</span><span class="p">)</span><span class="w"> 
</span><span class="n">covid_df_all_states</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">covid_df_all_states</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">Province_State</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We select the <strong>following columns</strong>, which are related to the daily measures, from the <strong><code class="language-plaintext highlighter-rouge">covid_df_all_states</code></strong> such as: <strong><code class="language-plaintext highlighter-rouge">Date</code></strong>, <strong><code class="language-plaintext highlighter-rouge">Country_Region</code></strong>, <strong><code class="language-plaintext highlighter-rouge">active</code></strong>, <strong><code class="language-plaintext highlighter-rouge">hospitalizedCurr</code></strong>, <strong><code class="language-plaintext highlighter-rouge">daily_tested</code></strong>, <strong><code class="language-plaintext highlighter-rouge">daily_positive</code></strong>.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">covid_df_all_states_daily</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">covid_df_all_states</span><span class="p">,</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">Country_Region</span><span class="p">,</span><span class="w"> </span><span class="n">active</span><span class="p">,</span><span class="w"> </span><span class="n">hospitalizedCurr</span><span class="p">,</span><span class="w"> </span><span class="n">daily_tested</span><span class="p">,</span><span class="w"> </span><span class="n">daily_positive</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Moreover, we sum <strong><code class="language-plaintext highlighter-rouge">daily_test</code></strong>, <strong><code class="language-plaintext highlighter-rouge">daily_positive</code></strong>, <strong><code class="language-plaintext highlighter-rouge">active</code></strong>, and <strong><code class="language-plaintext highlighter-rouge">hospitalizedCurr</code></strong> based on <strong><code class="language-plaintext highlighter-rouge">Country_Region</code></strong>.</p>

<p>Choose one of the coins at random and imagine spinning it repeatedly.   <br />
Here is the question:</p>

<blockquote>
  <p>Given that the <strong>first two spins</strong> from the chosen coin are <strong>tails</strong>, what is the <strong>expectation of the number of additional spins until a head shows up</strong>?</p>
</blockquote>

<p>To simplify our writing, we denote $\text{head}$ and $\text{tail}$ as $H$ and $T$ respectively. Therefore, we have</p>

\[\begin{align*}
    C_1 &amp;\rightarrow \Pr(H \mid C_1) = 0.6 = \frac{3}{5}, \tag{1}\label{eq:c1}\\
    C_2 &amp;\rightarrow \Pr(H \mid C_2) = 0.4 = \frac{2}{5}. \tag{2}\label{eq:c2}
  \end{align*}\]

<p><a href="/assets/images/Covid19-Top10-Rank-global-1June-ENG-Blue.png"><img src="/assets/images/Covid19-Top10-Rank-global-1June-ENG-Blue.png" alt="img1" class="img-responsive" /></a><em><center>An illustration of positive and negative sentiments. Image taken from <a href="https://www.thaipbsworld.com/10-countries-with-highest-number-of-covid-19-infections-as-of-june-1-2020/ ">Saad Arshad</a>, some rights reserved.</center></em></p>

<p>If we read the problem carefully, we may find that the problem consists of two steps as depicted in $\pmb{\text{Figure 1}}$. Particularly, random variable $N$ is a geometric distribution which has a <em>probability mass function</em> such that</p>

<p>\(\begin{equation}
    \Pr(n) = (1-C_i)^{n-1} C_i \tag{3}\label{eq:pmf-geometri}
  \end{equation}\)
where $C_i$ depends on either $C_1$ or $C_2$.</p>

<p>Now, let us compute
   \(\begin{equation}
    E(N \mid TT) = ? \tag{4}\label{eq:problem} 
   \end{equation}\)
as shown</p>

\[\begin{align}
    \text{E}(N \mid TT) &amp;= \int N \, \Pr(N \mid TT) \, dN &amp;&amp; \text{by definition} \tag{5}\label{eq:compute-1} \\ 
                   &amp;= \int \int N \, \Pr(N, C \mid TT) \, dC \, dN &amp;&amp; \text{by Bayes rule} \tag{6}\label{eq:compute-2} \\ 
                   &amp;= \int \int N \, \Pr(N \mid TT,C) \Pr(C \mid TT) \, dC \, dN &amp;&amp; \text{by conditional probability} \tag{7}\label{eq:compute-3} \\ 
                   &amp;= \int \underbrace{\int N \, \Pr(N \mid TT,C) \, dN}_{\text{E}(N \mid TT, C)} \, \Pr(C \mid TT) \, dC &amp;&amp; \text{just rearranging} \tag{8}\label{eq:compute-4} \\
                   &amp;= \int \text{E}(N \mid TT, C) \, \Pr(C \mid TT) \, dC &amp;&amp; \text{by expectation definition} \tag{9}\label{eq:compute-5} \\
                   &amp;= \sum_{i=1}^2 \text{E}(N \mid TT, C_i) \, \Pr(C_i \mid TT) &amp;&amp; \text{since }C \text{ is discrete .}   \tag{10}\label{eq:compute-6}                   
  \end{align}\]

<p>Recall that $N \sim$ geometric distribution; accordingly,</p>

\[\begin{align}
    \text{E}(N \mid TT, C_i) &amp;= \text{E}(N \mid C_i) &amp;&amp; \text{whether we have }TT\text{ as conditional or not} \tag{11}\label{eq:expectation-1} \\
                          &amp;= \frac{1}{C_i}         \tag{12}\label{eq:expectation-2}.
  \end{align}\]

<p>We proceed from Equation \eqref{eq:compute-6} as shown</p>

\[\begin{align}
  \text{E}(N \mid TT) &amp;= \text{E}(N \mid TT, C_1) \, \Pr(C_1 \mid TT) +  \text{E}(N \mid TT, C_2) \, \Pr(C_2 \mid TT) \tag{13}\label{eq:final-1} \\
                   &amp;= \frac{1}{C_1} \Pr(C_1 \mid TT) +  \frac{1}{C_2} \Pr(C_2 \mid TT) \tag{14}\label{eq:final-2}   \\
                   &amp;= \frac{1}{C_1} \underbrace{\frac{\Pr(TT \mid C_1) \, \Pr(C_1)}{\Pr(TT)}}_{\text{Part 1}} +  \frac{1}{C_2}  \underbrace{\frac{\Pr(TT \mid C_2) \, \Pr(C_2)}{\Pr(TT)}}_{\text{Part 2}} \tag{15}\label{eq:final-3}   \\
\end{align}\]

<p>Next, letâ€™s compute $\text{Part 1}$ which looks like</p>

\[\begin{align}
  \frac{\Pr(TT \mid C_1) \, \Pr(C_1)}{\Pr(TT)} &amp;= \frac{Pr(TT \mid C_1) \, \Pr(C_1)}{\Pr(TT \mid C_1) \, \Pr(C_1) + \Pr(TT \mid C_2) \, \Pr(C_2)} &amp;&amp; \text{expanding }\Pr(TT) \tag{16}\label{eq:part-1-1} \\
     &amp;= \frac{\left( \frac{2}{5} \right) \left( \frac{2}{5} \right) \left(\frac{1}{2} \right)}{\left( \frac{2}{5} \right) \left( \frac{2}{5} \right) \left( \frac{1}{2} \right) + \left( \frac{3}{5} \right) \left( \frac{3}{5} \right) \left( \frac{1}{2} \right)}. \tag{17}\label{eq:part-1-2} \\
\end{align}\]

<p>Similarly, we also calculate $\text{Part 2}$ in the following:</p>

\[\begin{align}
  \frac{\Pr(TT \mid C_2) \, \Pr(C_2)}{\Pr(TT)} &amp;= \frac{\Pr(TT \mid C_2) \, \Pr(C_2)}{\Pr(TT \mid C_1) \, \Pr(C_1) + \Pr(TT \mid C_2) \, \Pr(C_2)} &amp;&amp; \text{expanding }\Pr(TT) \tag{18}\label{eq:part-2-1} \\
     &amp;= \frac{\left( \frac{3}{5} \right) \left( \frac{3}{5} \right) \left( \frac{1}{2} \right) }{ \left( \frac{2}{5} \right) \left( \frac{2}{5} \right) \left( \frac{1}{2} \right) + \left( \frac{3}{5} \right) \left( \frac{3}{5} \right) \left( \frac{1}{2} \right) }. \tag{19}\label{eq:part-2-2} \\
\end{align}\]

<p>Finally, we are able to compute Equation \eqref{eq:problem} as</p>

\[\begin{align}
  \text{E}(N \mid TT) &amp;= \frac{1}{C_1} \, \text{Part 1} + \frac{1}{C_2} \, \text{Part 2} \tag{20}\label{eq:final-answer}\\
                 &amp;= \frac{1}{3/5} \, \text{Part 1} + \frac{1}{2/5} \, \text{Part 2} \\
                 &amp;= 2.2436   &amp;&amp; \text{utilizing Eq. }\eqref{eq:part-1-2}\text{ and Eq. }\eqref{eq:part-2-2} \\
                 &amp;\approx 3 &amp;&amp; \text{rounding the number.}
\end{align}\]

<p>This means that in order to <em>find a head</em> after we have two <strong>tails</strong> regardless the coin we choose, we need $\pmb{3}$ more throws <strong>on average</strong>.</p>
:ET